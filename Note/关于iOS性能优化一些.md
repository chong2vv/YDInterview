# iOS性能优化的一些东西
## 内存的几大区域
栈区、堆区、静态区、常量区、代码区

### 栈区(先进后出，编译器自动分配释放)
局部变量和实参等，栈是系统数据结构，对应线程/进程是唯一的，优点是快速高效，缺点是有限制、数据不灵活。

栈空间分静态分配、动态分配两种。
静态分配是编译器完成的，比如自动变量(auto)的分配。动态分配是alloca函数完成。栈的动态分配无需释放(自动)，也就没有释放函数，但是为了可移植的程序起见，栈的动态分配操作是不被鼓励的。

### 堆区(先进先出，程序员分配释放)
堆区是由程序员分配和释放的，如果程序员不释放，程序结束后可能由系统回收，比如在iOS中alloc都是存放在堆区的。优点是灵活方便，数据适应面广，但是效率有一定降低。

堆是函数库内部数据结构，不一定唯一。不同堆分配的内存无法相互操作。堆空间的分配总是动态的。

虽然程序结束时所有的数据控件都会被释放回系统，但是精确的内存申请，释放内存匹配是良好程序的要素。

### 静态区(程序结束后由系统释放)
全局变量和静态变量的存储是放在一起的，初始化的全局变量和静态变量放在一块区域，未初始化的全局变量和静态变量放在另一块区域，程序结束后系统释放。

静态区又可分为未初始化全局区、未初始化全局区。int a未初始化，int a=10初始化。

### 常量区(程序结束后由系统释放)

存放常量字符串，程序结束后由系统释放。

### 代码区(程序结束后由系统释放)

存放函数的二进制代码

#### 程序要想执行，第一步就需要被加载到内存中
- 栈区 局部变量和实参，iPhone的栈区大小512k（高地址区）
- 堆区 OC中使用new方法创建的对象，C中用malloc/calloc/realloc分配，需要free。
- BSS段 Xcode8中存储全局变量和静态变量
- 常量区 Xcode8中存储常量
- 代码段 程序的代码 （低地址区）

### 申请后的系统是如何响应的

栈：

存储每一个函数在执行的时候都会向操作系统索要资源，栈区就是函数运行时的内存，栈区中的变量由编译器负责分配和释放，内存随着函数的运行分配，随着函数的结束而释放，由系统自动完成。

注意：只要栈的剩余空间大于所申请空间，系统将为程序提供内存，否则将报异常提示栈溢出。

堆：

1. 首先应该知道操作系统有一个记录空闲内存地址的链表。
2. 当系统收到程序的申请时，会遍历该链表，寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲结点链表中删除，并将该结点的空间分配给程序。
3. 由于找到的堆结点的大小不一定正好等于申请的大小，系统会自动的将多余的那部分重新放入空闲链表中

### 申请大小的限制
栈：

栈是向低地址扩展的数据结构，是一块连续的内存的区域。是栈顶的地址和栈的最大容量是系统预先规定好的，栈的大小是2M（也有的说是1M，总之是一个编译时就确定的常数 ) ,如果申请的空间超过栈的剩余空间时，将提示overflow。因此，能从栈获得的空间较小。

堆：

堆是向高地址扩展的数据结构，是不连续的内存区域。这是由于系统是用链表来存储的空闲内存地址的，自然是不连续的，而链表的遍历方向是由低地址向高地址。堆的大小受限于计算机系统中有效的虚拟内存。由此可见，堆获得的空间比较灵活，也比较大